@model TalentoPlus.Web.Models.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard TalentoPlus";
}

<div class="page-shell">
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4 gap-3">
        <div>
            <div class="badge bg-primary text-uppercase mb-2">TalentoPlus · Dashboard</div>
            <h1 class="fw-bold mb-1">Panel del Administrador</h1>
            <p class="text-muted mb-0">Visibilidad completa de RRHH y preguntas en lenguaje natural con IA.</p>
        </div>
        <div class="text-md-end">
            <small class="text-muted d-block">Última actualización</small>
            <span class="fw-semibold">@DateTime.UtcNow.ToString("dd/MM/yyyy HH:mm") UTC</span>
        </div>
    </div>

    <div class="stat-grid mb-4">
        <div class="stat-card" style="background: linear-gradient(135deg,#0ea5e9,#6366f1);">
            <h3>Total de empleados</h3>
            <div class="value">@Model.TotalEmployees</div>
            <small>Base consolidada en PostgreSQL</small>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg,#f59e0b,#f97316);">
            <h3>En vacaciones</h3>
            <div class="value">@Model.OnVacation</div>
            <small>Planifica retornos y backfills</small>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg,#22c55e,#16a34a);">
            <h3>Activos</h3>
            <div class="value">@Model.ActiveEmployees</div>
            <small>Disponibles para asignaciones</small>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="status-column h-100">
                <div class="status-header">
                    <h6 class="fw-bold text-success mb-0">Activos (@Model.ActiveList.Count())</h6>
                </div>
                <div class="status-list">
                    @foreach (var e in Model.ActiveList)
                    {
                        <div class="status-item">
                            <div>
                                <div class="fw-semibold">@e.FirstName @e.LastName</div>
                                <div class="meta">@e.Position · @e.DepartmentName</div>
                            </div>
                            <span class="pill pill-active">Activo</span>
                        </div>
                    }
                    @if (!Model.ActiveList.Any())
                    {
                        <div class="text-muted small">Sin registros.</div>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="status-column h-100">
                <div class="status-header">
                    <h6 class="fw-bold text-warning mb-0">En vacaciones (@Model.VacationList.Count())</h6>
                </div>
                <div class="status-list">
                    @foreach (var e in Model.VacationList)
                    {
                        <div class="status-item">
                            <div>
                                <div class="fw-semibold">@e.FirstName @e.LastName</div>
                                <div class="meta">@e.Position · @e.DepartmentName</div>
                            </div>
                            <span class="pill pill-vacation">Vacaciones</span>
                        </div>
                    }
                    @if (!Model.VacationList.Any())
                    {
                        <div class="text-muted small">Sin registros.</div>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="status-column h-100">
                <div class="status-header">
                    <h6 class="fw-bold text-secondary mb-0">Inactivos (@Model.InactiveList.Count())</h6>
                </div>
                <div class="status-list">
                    @foreach (var e in Model.InactiveList)
                    {
                        <div class="status-item">
                            <div>
                                <div class="fw-semibold">@e.FirstName @e.LastName</div>
                                <div class="meta">@e.Position · @e.DepartmentName</div>
                            </div>
                            <span class="pill pill-inactive">Inactivo</span>
                        </div>
                    }
                    @if (!Model.InactiveList.Any())
                    {
                        <div class="text-muted small">Sin registros.</div>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3 gap-2">
                <div>
                    <h5 class="fw-bold mb-0">Consultas con IA</h5>
                    <small class="text-muted">Pregunta en lenguaje natural y obtenemos el número real desde la base.</small>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                    <span class="badge bg-light text-dark border">departamento</span>
                    <span class="badge bg-light text-dark border">estado</span>
                    <span class="badge bg-light text-dark border">cargo</span>
                </div>
            </div>

            <form asp-action="AskAi" method="post" class="mb-3">
                <div class="input-group input-group-lg">
                    <input name="question" class="form-control" placeholder="Ej: ¿Cuántos empleados pertenecen a Tecnología?" required />
                    <button type="submit" class="btn btn-primary">Consultar</button>
                </div>
            </form>

            <div class="d-flex gap-2 flex-wrap mb-3">
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="fillPrompt('¿Cuántos auxiliares hay en la plataforma?')">Auxiliares</button>
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="fillPrompt('¿Cuántos empleados pertenecen al departamento de Tecnología?')">Departamento Tecnología</button>
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="fillPrompt('¿Cuántos empleados están en estado Inactivo?')">Inactivos</button>
            </div>

            @if (Model.AiResult != null)
            {
                <div class="alert alert-info">
                    <p class="mb-1"><strong>Pregunta:</strong> @Model.AiResult.Question</p>
                    <p class="mb-1"><strong>Interpretación:</strong> @Model.AiResult.SqlLikeQuery</p>
                    <p class="mb-0"><strong>Resultado:</strong> @Model.AiResult.Result</p>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function fillPrompt(text) {
            const input = document.querySelector('input[name="question"]');
            if (input) {
                input.value = text;
                input.focus();
            }
        }
    </script>
}
